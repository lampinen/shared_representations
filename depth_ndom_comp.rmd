---
title: "Depth & Number of Domains Comparison"
author: "AndrewLampinen"
date: "September 19, 2017"
output: html_document
---
```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
```

```{r}
num_runs = 100
networks = c('linear', 'nonlinear')

d = data.frame()
for (network in networks) {
  for (nlayer in c(2, 3)) {
    for (ndomains in 1:2) {
      for (rseed in 0:(num_runs-1)) {
        filename = sprintf("./results/depth_and_ndom_comp/%s_nlayer_%i_ndomains_%i_rseed_%i_loss_track.csv",network,nlayer,ndomains,rseed)
        this_d = read.csv(filename, header=T)
        this_d = this_d %>%
          mutate(num_layers=nlayer,
                 num_domains=ndomains,
                 network=network,
                 rseed=rseed)
        d = bind_rows(d, this_d)
      }
    }
  }
}
```

```{r}
d = d %>%
  filter(epoch < 1000 | (num_layers == 3 & epoch < 2000)) %>%
  mutate(num_domains = factor(num_domains),
         num_layers = factor(num_layers, labels=c("Two layers", "Three layers")),
         network = factor(network, labels=c("Fully linear", "Final layer nonlinear")))
```

```{r}
avg_d = d %>% 
  group_by(num_layers, num_domains, network, epoch) %>%
  summarize(MSE=mean(MSE)) %>%
  ungroup() %>%
  mutate(log_MSE=log(MSE))
```

```{r}
ggplot(data=avg_d, aes(x=epoch, y=MSE, color=num_domains)) +
  geom_line(size=1.25) +
  facet_grid(network ~ num_layers, scales="free_x") +
  scale_color_brewer(palette="Set1", labels=c("One task", "Both")) +
  theme_bw(base_size=15) +
  labs(color='# of Domains') +
  theme(plot.background = element_blank(),panel.grid.major = element_blank(),panel.grid.minor = element_blank())
```
```{r}
#ggsave("result_plots/depth_ndom_comp_fixed_hidden.png")
ggsave("talks/lightning/figures/depth_ndom_comp.png", width=7, height=5)

```

